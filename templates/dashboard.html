{% extends "base.html" %}

{% block content %}
    <!-- 引入各个功能模块 -->
    {% include "modules/search.html" %}
    {% include "modules/overview.html" %}

    <!-- 基金公司分析概览 -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">基金公司分析概览 (按总规模排序)</h4>
                </div>
                <div class="card-body">
                    {% if company_analytics %}
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>基金公司</th>
                                    <th class="text-end">产品数量</th>
                                    <th class="text-end">总规模 (亿)</th>
                                    <th class="text-end">平均涨跌幅 (%)</th>
                                    <th class="text-end">总成交额 (万)</th>
                                    <th class="text-end">总关注人数</th>
                                    <th class="text-end">商务品数量</th>
                                    <th class="text-center">数据更新时间</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for company in company_analytics %}
                                <tr>
                                    <td>{{ company.company_name }}</td>
                                    <td class="text-end">{{ company.product_count }}</td>
                                    <td class="text-end">{{ "%.2f"|format(company.total_fund_size) if company.total_fund_size is not none else '-' }}</td>
                                    <td class="text-end">
                                        {% if company.avg_price_change_rate is not none %}
                                            <span class="{{ 'text-danger' if company.avg_price_change_rate < 0 else 'text-success' if company.avg_price_change_rate > 0 else '' }}">
                                                {{ "%.2f%%"|format(company.avg_price_change_rate * 100) }}
                                            </span>
                                        {% else %}
                                            -
                                        {% endif %}
                                    </td>
                                    <td class="text-end">{{ "%.2f"|format(company.total_amount) if company.total_amount is not none else '-' }}</td>
                                    <td class="text-end">{{ company.total_attention_count if company.total_attention_count is not none else '-' }}</td>
                                    <td class="text-end">{{ company.business_agreement_count if company.business_agreement_count is not none else '-' }}</td>
                                    <td class="text-center">{{ company.update_timestamp.split(' ')[0] if company.update_timestamp else '-' }}</td> {# 仅显示日期部分 #}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-center">暂无基金公司分析数据。</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    {% include "modules/business.html" %}
    {% include "modules/report.html" %}
{% endblock %}
